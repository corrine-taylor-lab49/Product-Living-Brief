<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Living Product Brief</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%);
            min-height: 100vh;
            padding: 60px 20px;
            color: #E2E8F0;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 60px;
        }

        .header h1 {
            font-size: 48px;
            font-weight: 300;
            color: #F8FAFC;
            letter-spacing: -1px;
            margin-bottom: 24px;
        }

        .settings-link {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 13px;
            color: #94A3B8;
            text-decoration: none;
            cursor: pointer;
        }

        .settings-link:hover {
            color: #60A5FA;
        }

        .tabs {
            display: flex;
            gap: 8px;
            justify-content: center;
        }

        .tab-btn {
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid rgba(148, 163, 184, 0.2);
            color: #94A3B8;
            padding: 12px 32px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab-btn:hover {
            border-color: #60A5FA;
            color: #E2E8F0;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);
            border-color: transparent;
            color: white;
        }

        .brief-container {
            background: rgba(30, 41, 59, 0.4);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            border: 1px solid rgba(148, 163, 184, 0.1);
            padding: 60px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        .status-badge {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background: rgba(251, 191, 36, 0.1);
            color: #FCD34D;
            border: 1px solid rgba(251, 191, 36, 0.2);
            margin-bottom: 40px;
        }

        .title-input {
            font-size: 32px;
            font-weight: 300;
            border: none;
            border-bottom: 1px solid rgba(148, 163, 184, 0.2);
            outline: none;
            width: 100%;
            padding: 16px 0;
            margin-bottom: 40px;
            transition: all 0.3s;
            color: #F8FAFC;
            background: transparent;
            letter-spacing: -0.5px;
        }

        .title-input:focus {
            border-bottom-color: #60A5FA;
        }

        .title-input::placeholder {
            color: #475569;
        }

        .meta-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 60px;
        }

        .meta-item {
            background: rgba(15, 23, 42, 0.5);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(148, 163, 184, 0.1);
        }

        .meta-label {
            font-size: 11px;
            text-transform: uppercase;
            color: #94A3B8;
            font-weight: 600;
            margin-bottom: 8px;
            letter-spacing: 1px;
        }

        input[type="text"], input[type="number"], textarea, select {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.3s;
            color: #E2E8F0;
            background: rgba(15, 23, 42, 0.5);
            line-height: 1.5;
        }

        input[type="text"]:focus, input[type="number"]:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #60A5FA;
            background: rgba(15, 23, 42, 0.8);
        }

        input[type="text"]::placeholder, textarea::placeholder {
            color: #475569;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .section {
            margin-bottom: 60px;
            padding-bottom: 60px;
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
        }

        .section:last-child {
            border-bottom: none;
        }

        .section-header {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 20px;
            font-weight: 600;
            color: #F8FAFC;
            letter-spacing: -0.3px;
            margin-bottom: 8px;
        }

        .section-subtitle {
            font-size: 13px;
            color: #94A3B8;
            line-height: 1.6;
        }

        .field {
            margin-bottom: 24px;
        }

        .field-label {
            font-size: 13px;
            font-weight: 600;
            color: #CBD5E1;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ai-suggest {
            background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);
            color: white;
            border: none;
            padding: 6px 14px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            margin-left: auto;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .ai-suggest:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.5);
        }

        .warning-box {
            background: rgba(251, 191, 36, 0.05);
            border-left: 3px solid #FCD34D;
            padding: 16px 20px;
            border-radius: 8px;
            margin-bottom: 24px;
            font-size: 13px;
            color: #FCD34D;
            line-height: 1.6;
        }

        .info-text {
            font-size: 12px;
            color: #64748B;
            margin-top: 8px;
            line-height: 1.5;
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 12px;
            align-items: end;
        }

        .kpi-label {
            font-size: 10px;
            text-transform: uppercase;
            color: #64748B;
            margin-bottom: 6px;
            letter-spacing: 0.5px;
        }

        .kpi-label.disabled {
            color: #475569;
        }

        input.disabled-result {
            background: rgba(15, 23, 42, 0.3);
            color: #475569;
            border-color: rgba(148, 163, 184, 0.1);
            cursor: not-allowed;
        }

        .stakeholder-row {
            display: grid;
            grid-template-columns: 2fr 2fr 1fr;
            gap: 12px;
            margin-bottom: 12px;
        }

        /* Requirements Tab Styles */
        .requirements-header {
            text-align: center;
            margin-bottom: 48px;
        }

        .generate-btn {
            background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 24px;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 12px;
        }

        .generate-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(59, 130, 246, 0.5);
        }

        .generate-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .source-summary {
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid rgba(148, 163, 184, 0.1);
            border-radius: 12px;
            padding: 32px;
            margin-bottom: 48px;
        }

        .source-summary h3 {
            font-size: 14px;
            font-weight: 600;
            color: #94A3B8;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 24px;
        }

        .summary-item {
            background: rgba(15, 23, 42, 0.8);
            padding: 16px;
            border-radius: 8px;
        }

        .summary-label {
            font-size: 11px;
            text-transform: uppercase;
            color: #64748B;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
        }

        .summary-value {
            font-size: 14px;
            color: #E2E8F0;
            line-height: 1.5;
        }

        .loading-state {
            text-align: center;
            padding: 60px 20px;
        }

        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 4px solid rgba(148, 163, 184, 0.2);
            border-top-color: #60A5FA;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 24px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            color: #94A3B8;
            font-size: 14px;
        }

        .error-box {
            background: rgba(239, 68, 68, 0.1);
            border-left: 3px solid #EF4444;
            padding: 16px 20px;
            border-radius: 8px;
            margin-bottom: 24px;
            font-size: 13px;
            color: #FCA5A5;
            line-height: 1.6;
        }

        .epic-card {
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid rgba(148, 163, 184, 0.1);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .epic-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .epic-id {
            background: rgba(59, 130, 246, 0.2);
            color: #60A5FA;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .epic-title {
            font-size: 18px;
            font-weight: 600;
            color: #F8FAFC;
            flex: 1;
        }

        .epic-title-input {
            font-size: 18px;
            font-weight: 600;
            color: #F8FAFC;
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(148, 163, 184, 0.3);
            border-radius: 6px;
            padding: 8px 12px;
            width: 100%;
        }

        .epic-description {
            color: #94A3B8;
            font-size: 14px;
            margin-bottom: 24px;
            line-height: 1.6;
        }

        .epic-description-input {
            color: #E2E8F0;
            font-size: 14px;
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(148, 163, 184, 0.3);
            border-radius: 6px;
            padding: 12px;
            width: 100%;
            min-height: 80px;
        }

        .stories-header {
            font-size: 12px;
            font-weight: 600;
            color: #64748B;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 16px;
            padding-top: 20px;
            border-top: 1px solid rgba(148, 163, 184, 0.1);
        }

        .story-card {
            background: rgba(15, 23, 42, 0.8);
            border-left: 3px solid #3B82F6;
            padding: 16px;
            margin-bottom: 12px;
            border-radius: 6px;
            position: relative;
        }

        .story-card.rejected {
            opacity: 0.4;
            border-left-color: #64748B;
        }

        .story-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .story-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .story-id {
            color: #60A5FA;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .story-title {
            font-size: 14px;
            font-weight: 600;
            color: #CBD5E1;
            flex: 1;
        }

        .story-title-input {
            font-size: 14px;
            font-weight: 600;
            color: #E2E8F0;
            background: rgba(15, 23, 42, 0.9);
            border: 1px solid rgba(148, 163, 184, 0.3);
            border-radius: 4px;
            padding: 6px 10px;
            width: 100%;
        }

        .story-description {
            color: #94A3B8;
            font-size: 13px;
            line-height: 1.5;
            margin-left: 30px;
        }

        .story-description-input {
            color: #E2E8F0;
            font-size: 13px;
            background: rgba(15, 23, 42, 0.9);
            border: 1px solid rgba(148, 163, 184, 0.3);
            border-radius: 4px;
            padding: 8px 10px;
            width: 100%;
            min-height: 60px;
            margin-left: 30px;
        }

        .edit-btn {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            color: #60A5FA;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .edit-btn:hover {
            background: rgba(59, 130, 246, 0.2);
        }

        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 32px;
            flex-wrap: wrap;
        }

        .secondary-btn {
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(148, 163, 184, 0.2);
            color: #E2E8F0;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .secondary-btn:hover {
            border-color: #60A5FA;
            background: rgba(59, 130, 246, 0.1);
        }

        @media (max-width: 768px) {
            body {
                padding: 40px 16px;
            }

            .brief-container {
                padding: 32px 24px;
            }

            .header h1 {
                font-size: 32px;
            }

            .meta-grid {
                grid-template-columns: 1fr;
            }

            .kpi-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .stakeholder-row {
                grid-template-columns: 1fr;
            }

            .summary-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a class="settings-link" onclick="clearApiKey()">ðŸ”‘ Clear API Key</a>
        
        <div class="header">
            <h1>Living Product Brief</h1>
            
            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('brief')">Brief</button>
                <button class="tab-btn" onclick="switchTab('requirements')">Requirements</button>
            </div>
        </div>

        <!-- Brief Tab -->
        <div class="brief-container" id="brief-tab">
            <span class="status-badge" id="status-badge">Draft</span>
            
            <input 
                type="text" 
                class="title-input" 
                placeholder="Project Title"
                id="project-title"
                oninput="autosave()"
            >
            
            <div class="meta-grid">
                <div class="meta-item">
                    <div class="meta-label">Owner</div>
                    <input type="text" placeholder="PM Name" id="owner" oninput="autosave()">
                </div>
                <div class="meta-item">
                    <div class="meta-label">Target Quarter</div>
                    <input type="text" placeholder="Q1 2026" id="target-quarter" oninput="autosave()">
                </div>
                <div class="meta-item">
                    <div class="meta-label">Priority</div>
                    <select id="priority" onchange="autosave()">
                        <option value="">Select Priority</option>
                        <option value="p0">P0 - Must Have</option>
                        <option value="p1">P1 - Should Have</option>
                        <option value="p2">P2 - Nice to Have</option>
                    </select>
                </div>
                <div class="meta-item">
                    <div class="meta-label">Est. Value</div>
                    <input type="text" placeholder="$450K/year" id="value" oninput="autosave()">
                </div>
            </div>

            <!-- Problem Statement -->
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">Problem Statement</h2>
                    <p class="section-subtitle">What problem are we solving and what's the impact?</p>
                </div>
                <div class="field">
                    <div class="field-label">
                        Problem Description
                        <button class="ai-suggest" onclick="aiSuggestExample('problem')">âœ¨ AI Suggest</button>
                    </div>
                    <textarea 
                        id="problem-statement" 
                        placeholder="Describe what's broken or missing today..."
                        oninput="autosave()"
                    ></textarea>
                </div>
                <div class="field">
                    <div class="field-label">Quantified Impact</div>
                    <input 
                        type="text" 
                        id="problem-impact" 
                        placeholder="e.g., 85% of users ignore dashboard, costing $200K/year"
                        oninput="autosave()"
                    >
                </div>
            </div>

            <!-- Personas -->
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">Target Users & Personas</h2>
                    <p class="section-subtitle">Who are we building this for? Be specific.</p>
                </div>
                
                <div class="warning-box">
                    <strong>Key Question:</strong> "All users" is not an answer.
                </div>

                <div class="field">
                    <div class="field-label">
                        Persona - Key Insights
                        <button class="ai-suggest" onclick="aiSuggestExample('personas')">âœ¨ AI Suggest</button>
                    </div>
                    <textarea 
                        id="persona-insights" 
                        placeholder="Who are they? What are their goals, pain points, and behaviors? What have you learned from research?"
                        style="min-height: 120px;"
                        oninput="autosave()"
                    ></textarea>
                </div>

                <div class="field">
                    <div class="field-label">Persona - What Success Looks Like</div>
                    <textarea 
                        id="persona-success" 
                        placeholder="From the user's perspective, what does success look like? Be specific and concrete."
                        style="min-height: 80px;"
                        oninput="autosave()"
                    ></textarea>
                </div>
            </div>

            <!-- Opportunity -->
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">Opportunity</h2>
                    <p class="section-subtitle">What's the business value if we solve this?</p>
                </div>
                <div class="field">
                    <div class="field-label">
                        Business Value
                        <button class="ai-suggest" onclick="aiSuggestExample('opportunity')">âœ¨ AI Suggest</button>
                    </div>
                    <textarea 
                        id="opportunity-statement" 
                        placeholder="Describe the business opportunity and value..."
                        oninput="autosave()"
                    ></textarea>
                </div>
            </div>

            <!-- KPI -->
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">Key Performance Indicator</h2>
                    <p class="section-subtitle">How will we measure success? Results will be updated after launch.</p>
                </div>

                <div class="field">
                    <div class="field-label">
                        Primary Success Metric
                        <button class="ai-suggest" onclick="aiSuggestExample('kpi')">âœ¨ AI Suggest</button>
                    </div>
                    <div class="kpi-grid">
                        <div>
                            <input 
                                type="text" 
                                placeholder="Metric name (e.g., Daily Active Users)" 
                                id="kpi1-name"
                                oninput="autosave()"
                            >
                        </div>
                        <div>
                            <div class="kpi-label">Baseline</div>
                            <input 
                                type="text" 
                                placeholder="15%" 
                                id="kpi1-baseline"
                                oninput="autosave()"
                            >
                        </div>
                        <div>
                            <div class="kpi-label">Target</div>
                            <input 
                                type="text" 
                                placeholder="60%" 
                                id="kpi1-target"
                                oninput="autosave()"
                            >
                        </div>
                        <div>
                            <div class="kpi-label disabled">Results</div>
                            <input 
                                type="text" 
                                placeholder="TBD" 
                                id="kpi1-results"
                                class="disabled-result"
                            >
                        </div>
                    </div>
                    <div style="margin-top: 12px;">
                        <input 
                            type="text" 
                            placeholder="How measured? Timeline? (e.g., Google Analytics, within 3 months)" 
                            id="kpi1-method"
                            oninput="autosave()"
                        >
                    </div>
                </div>
            </div>

            <!-- Customer Announcement -->
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">Customer Announcement</h2>
                    <p class="section-subtitle">How would you announce this to customers?</p>
                </div>
                <div class="field">
                    <div class="field-label">
                        Draft Announcement
                        <button class="ai-suggest" onclick="aiSuggestExample('announcement')">âœ¨ AI Suggest</button>
                    </div>
                    <textarea 
                        id="customer-announcement" 
                        placeholder="Write as if it's launch day. What's the headline? What's the benefit?"
                        style="min-height: 100px;"
                        oninput="autosave()"
                    ></textarea>
                    <div class="info-text">
                        Tip: If you can't write a clear announcement, rethink the feature.
                    </div>
                </div>
                <div class="field">
                    <div class="field-label">One-Sentence Benefit</div>
                    <input 
                        type="text" 
                        id="customer-benefit" 
                        placeholder="e.g., See your metrics in seconds instead of minutes"
                        oninput="autosave()"
                    >
                </div>
            </div>

            <!-- Stakeholders -->
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">Stakeholders</h2>
                    <p class="section-subtitle">Who needs to approve and who should be consulted?</p>
                </div>
                
                <div class="warning-box">
                    <strong>Critical:</strong> The #1 reason projects fail is misalignment. Map early.
                </div>

                <div class="field">
                    <div class="field-label">
                        Decision Makers (Must Approve)
                        <button class="ai-suggest" onclick="aiSuggestExample('stakeholders')">âœ¨ AI Suggest</button>
                    </div>
                    <div class="stakeholder-row">
                        <input type="text" placeholder="Name" id="dm1-name" oninput="autosave()">
                        <input type="text" placeholder="Role" id="dm1-role" oninput="autosave()">
                        <select id="dm1-status" onchange="autosave()">
                            <option value="">Status</option>
                            <option value="aligned">Aligned</option>
                            <option value="pending">Pending</option>
                            <option value="concerns">Concerns</option>
                        </select>
                    </div>
                    <div class="stakeholder-row">
                        <input type="text" placeholder="Name" id="dm2-name" oninput="autosave()">
                        <input type="text" placeholder="Role" id="dm2-role" oninput="autosave()">
                        <select id="dm2-status" onchange="autosave()">
                            <option value="">Status</option>
                            <option value="aligned">Aligned</option>
                            <option value="pending">Pending</option>
                            <option value="concerns">Concerns</option>
                        </select>
                    </div>
                </div>

                <div class="field">
                    <div class="field-label">SMEs / Consulted</div>
                    <input 
                        type="text" 
                        placeholder="Who needs to provide input? (e.g., Design team, Engineering, Data team, Legal, Security...)" 
                        id="smes-consulted"
                        oninput="autosave()"
                    >
                </div>
            </div>

            <!-- Features -->
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">Key Features</h2>
                    <p class="section-subtitle">What are we building? High-level overview.</p>
                </div>
                <div class="field">
                    <textarea 
                        id="features-summary" 
                        placeholder="List 3-5 key features..."
                        style="min-height: 120px;"
                        oninput="autosave()"
                    ></textarea>
                </div>
            </div>
        </div>

        <!-- Requirements Tab -->
        <div class="brief-container" id="requirements-tab" style="display: none;">
            <div class="requirements-header">
                <h2 class="section-title">Generate Requirements</h2>
                <p class="section-subtitle">AI will analyze your brief and generate epics and user stories</p>
                
                <button class="generate-btn" onclick="generateRequirements()" id="generate-btn">
                    <span class="btn-icon">âœ¨</span>
                    Generate Epics & Stories
                </button>
            </div>

            <!-- Source Summary -->
            <div class="source-summary" id="source-summary">
                <h3>Using Brief Data:</h3>
                <div class="summary-grid">
                    <div class="summary-item">
                        <div class="summary-label">Project</div>
                        <div class="summary-value" id="sum-title">â€”</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">KPI</div>
                        <div class="summary-value" id="sum-kpi">â€”</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Priority</div>
                        <div class="summary-value" id="sum-priority">â€”</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Features</div>
                        <div class="summary-value" id="sum-features">â€”</div>
                    </div>
                </div>
            </div>

            <!-- Loading State -->
            <div id="loading-state" style="display: none;">
                <div class="loading-spinner"></div>
                <p class="loading-text">Analyzing brief and generating requirements...</p>
            </div>

            <!-- Error State -->
            <div id="error-state" style="display: none;">
                <div class="error-box" id="error-message"></div>
            </div>

            <!-- Generated Requirements -->
            <div id="generated-requirements" style="display: none;">
                <div class="requirements-output">
                    <h3 class="output-title" style="font-size: 20px; font-weight: 600; color: #F8FAFC; margin-bottom: 32px;">Generated Epics & User Stories</h3>
                    
                    <div id="epics-container"></div>
                    
                    <div class="action-buttons">
                        <button class="secondary-btn" onclick="exportToMarkdown()">
                            ðŸ“„ Export to Markdown
                        </button>
                        <button class="secondary-btn" onclick="regenerateRequirements()">
                            ðŸ”„ Regenerate
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API Key Management
        function getApiKey() {
            let apiKey = localStorage.getItem('claudeApiKey');
            if (!apiKey) {
                apiKey = prompt('Enter your Claude API key:\n\nGet one at: https://console.anthropic.com\n\n(It will be saved in your browser)');
                if (apiKey) {
                    localStorage.setItem('claudeApiKey', apiKey);
                }
            }
            return apiKey;
        }

        function clearApiKey() {
            localStorage.removeItem('claudeApiKey');
            alert('API key cleared. You will be prompted again on next generation.');
        }

        let currentEpics = [];
        let autosaveTimer = null;

        // Tab switching
        function switchTab(tab) {
            const briefTab = document.getElementById('brief-tab');
            const requirementsTab = document.getElementById('requirements-tab');
            const tabs = document.querySelectorAll('.tab-btn');
            
            tabs.forEach(t => t.classList.remove('active'));
            
            if (tab === 'brief') {
                briefTab.style.display = 'block';
                requirementsTab.style.display = 'none';
                tabs[0].classList.add('active');
            } else {
                briefTab.style.display = 'none';
                requirementsTab.style.display = 'block';
                tabs[1].classList.add('active');
                updateSourceSummary();
            }
        }

        // Autosave to localStorage
        function autosave() {
            clearTimeout(autosaveTimer);
            autosaveTimer = setTimeout(() => {
                const briefData = gatherBriefData();
                localStorage.setItem('productBrief', JSON.stringify(briefData));
                console.log('Autosaved');
            }, 500);
        }

        // Load saved brief on page load
        window.addEventListener('load', () => {
            const saved = localStorage.getItem('productBrief');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    loadBriefData(data);
                } catch (e) {
                    console.error('Failed to load saved brief:', e);
                }
            }
        });

        function gatherBriefData() {
            return {
                title: document.getElementById('project-title').value,
                owner: document.getElementById('owner').value,
                targetQuarter: document.getElementById('target-quarter').value,
                priority: document.getElementById('priority').value,
                value: document.getElementById('value').value,
                problemStatement: document.getElementById('problem-statement').value,
                problemImpact: document.getElementById('problem-impact').value,
                personaInsights: document.getElementById('persona-insights').value,
                personaSuccess: document.getElementById('persona-success').value,
                opportunity: document.getElementById('opportunity-statement').value,
                kpi: {
                    name: document.getElementById('kpi1-name').value,
                    baseline: document.getElementById('kpi1-baseline').value,
                    target: document.getElementById('kpi1-target').value,
                    method: document.getElementById('kpi1-method').value,
                    results: document.getElementById('kpi1-results').value
                },
                announcement: document.getElementById('customer-announcement').value,
                benefit: document.getElementById('customer-benefit').value,
                stakeholders: {
                    dm1: {
                        name: document.getElementById('dm1-name').value,
                        role: document.getElementById('dm1-role').value,
                        status: document.getElementById('dm1-status').value
                    },
                    dm2: {
                        name: document.getElementById('dm2-name').value,
                        role: document.getElementById('dm2-role').value,
                        status: document.getElementById('dm2-status').value
                    },
                    smes: document.getElementById('smes-consulted').value
                },
                features: document.getElementById('features-summary').value
            };
        }

        function loadBriefData(data) {
            document.getElementById('project-title').value = data.title || '';
            document.getElementById('owner').value = data.owner || '';
            document.getElementById('target-quarter').value = data.targetQuarter || '';
            document.getElementById('priority').value = data.priority || '';
            document.getElementById('value').value = data.value || '';
            document.getElementById('problem-statement').value = data.problemStatement || '';
            document.getElementById('problem-impact').value = data.problemImpact || '';
            document.getElementById('persona-insights').value = data.personaInsights || '';
            document.getElementById('persona-success').value = data.personaSuccess || '';
            document.getElementById('opportunity-statement').value = data.opportunity || '';
            document.getElementById('kpi1-name').value = data.kpi?.name || '';
            document.getElementById('kpi1-baseline').value = data.kpi?.baseline || '';
            document.getElementById('kpi1-target').value = data.kpi?.target || '';
            document.getElementById('kpi1-method').value = data.kpi?.method || '';
            document.getElementById('kpi1-results').value = data.kpi?.results || '';
            document.getElementById('customer-announcement').value = data.announcement || '';
            document.getElementById('customer-benefit').value = data.benefit || '';
            document.getElementById('dm1-name').value = data.stakeholders?.dm1?.name || '';
            document.getElementById('dm1-role').value = data.stakeholders?.dm1?.role || '';
            document.getElementById('dm1-status').value = data.stakeholders?.dm1?.status || '';
            document.getElementById('dm2-name').value = data.stakeholders?.dm2?.name || '';
            document.getElementById('dm2-role').value = data.stakeholders?.dm2?.role || '';
            document.getElementById('dm2-status').value = data.stakeholders?.dm2?.status || '';
            document.getElementById('smes-consulted').value = data.stakeholders?.smes || '';
            document.getElementById('features-summary').value = data.features || '';
        }

        function updateSourceSummary() {
            const data = gatherBriefData();
            
            document.getElementById('sum-title').textContent = data.title || 'â€”';
            
            const kpiText = data.kpi.name && data.kpi.target 
                ? `${data.kpi.name} â†’ ${data.kpi.target}` 
                : 'â€”';
            document.getElementById('sum-kpi').textContent = kpiText;
            
            document.getElementById('sum-priority').textContent = 
                data.priority ? data.priority.toUpperCase() : 'â€”';
            
            const featuresPreview = data.features 
                ? data.features.substring(0, 100) + (data.features.length > 100 ? '...' : '')
                : 'â€”';
            document.getElementById('sum-features').textContent = featuresPreview;
        }

        async function generateRequirements() {
            const CLAUDE_API_KEY = getApiKey();
            
            if (!CLAUDE_API_KEY) {
                alert('API key required to generate requirements.');
                return;
            }

            const briefData = gatherBriefData();
            
            // Validate we have enough data
            if (!briefData.problemStatement || !briefData.features) {
                alert('Please fill out at least the Problem Statement and Key Features before generating requirements.');
                return;
            }

            // Show loading
            document.getElementById('loading-state').style.display = 'block';
            document.getElementById('error-state').style.display = 'none';
            document.getElementById('generated-requirements').style.display = 'none';
            document.getElementById('generate-btn').disabled = true;

            try {
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': CLAUDE_API_KEY,
                        'anthropic-version': '2023-06-01'
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 4000,
                        messages: [{
                            role: 'user',
                            content: buildPrompt(briefData)
                        }]
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error?.message || `API Error: ${response.status} ${response.statusText}`);
                }

                const data = await response.json();
                const text = data.content[0].text;
                
                // Parse JSON response
                const cleanText = text.replace(/```json|```/g, '').trim();
                const requirements = JSON.parse(cleanText);
                
                currentEpics = requirements.epics;
                displayEpics(currentEpics);
                
                // Hide loading, show results
                document.getElementById('loading-state').style.display = 'none';
                document.getElementById('generated-requirements').style.display = 'block';
                
            } catch (error) {
                console.error('Generation error:', error);
                document.getElementById('loading-state').style.display = 'none';
                document.getElementById('error-state').style.display = 'block';
                document.getElementById('error-message').textContent = 
                    `Error: ${error.message}\n\nMake sure your API key is correct and you have credits available.`;
            } finally {
                document.getElementById('generate-btn').disabled = false;
            }
        }

        function buildPrompt(briefData) {
            return `You are a senior product manager. Read this product brief and generate detailed epics and user stories.

PRODUCT BRIEF:

Title: ${briefData.title}
Priority: ${briefData.priority}

Problem: ${briefData.problemStatement}
Impact: ${briefData.problemImpact}

Target Users: ${briefData.personaInsights}
Success Criteria: ${briefData.personaSuccess}

Business Opportunity: ${briefData.opportunity}

KPI: ${briefData.kpi.name} (${briefData.kpi.baseline} â†’ ${briefData.kpi.target})
Measurement: ${briefData.kpi.method}

Key Features:
${briefData.features}

---

Generate 3-5 epics that break down these features into logical workstreams. For each epic, create 3-5 user stories.

REQUIREMENTS:
- Each user story must follow format: "As a [persona], I want [goal] so that [benefit]"
- Stories should be specific, testable, and valuable
- Include acceptance criteria when relevant
- Consider both happy path and edge cases
- Think about technical requirements, design needs, and analytics

Return ONLY valid JSON in this exact format:
{
  "epics": [
    {
      "id": "EPIC-1",
      "title": "Brief epic title",
      "description": "Detailed description of what this epic accomplishes",
      "stories": [
        {
          "id": "US-1.1",
          "title": "Brief story title",
          "description": "As a [persona], I want [goal] so that [benefit]",
          "accepted": true
        }
      ]
    }
  ]
}`;
        }

        function displayEpics(epics) {
            const container = document.getElementById('epics-container');
            container.innerHTML = '';
            
            epics.forEach((epic, epicIndex) => {
                const epicCard = document.createElement('div');
                epicCard.className = 'epic-card';
                epicCard.innerHTML = `
                    <div class="epic-header">
                        <span class="epic-id">${epic.id}</span>
                        <div class="epic-title" id="epic-title-${epicIndex}">${epic.title}</div>
                        <button class="edit-btn" onclick="editEpic(${epicIndex})">Edit</button>
                    </div>
                    <div class="epic-description" id="epic-desc-${epicIndex}">${epic.description}</div>
                    
                    <div class="stories-header">User Stories (${epic.stories.length})</div>
                    <div id="stories-${epicIndex}">
                        ${epic.stories.map((story, storyIndex) => `
                            <div class="story-card ${story.accepted === false ? 'rejected' : ''}" id="story-${epicIndex}-${storyIndex}">
                                <div class="story-header">
                                    <input type="checkbox" class="story-checkbox" ${story.accepted !== false ? 'checked' : ''} 
                                           onchange="toggleStory(${epicIndex}, ${storyIndex}, this.checked)">
                                    <span class="story-id">${story.id}</span>
                                    <div class="story-title" id="story-title-${epicIndex}-${storyIndex}">${story.title}</div>
                                    <button class="edit-btn" onclick="editStory(${epicIndex}, ${storyIndex})">Edit</button>
                                </div>
                                <div class="story-description" id="story-desc-${epicIndex}-${storyIndex}">${story.description}</div>
                            </div>
                        `).join('')}
                    </div>
                `;
                container.appendChild(epicCard);
            });
        }

        function editEpic(epicIndex) {
            const epic = currentEpics[epicIndex];
            const titleEl = document.getElementById(`epic-title-${epicIndex}`);
            const descEl = document.getElementById(`epic-desc-${epicIndex}`);
            
            titleEl.innerHTML = `<input type="text" class="epic-title-input" value="${epic.title}" id="epic-title-input-${epicIndex}">`;
            descEl.innerHTML = `<textarea class="epic-description-input" id="epic-desc-input-${epicIndex}">${epic.description}</textarea>`;
            
            const titleInput = document.getElementById(`epic-title-input-${epicIndex}`);
            const descInput = document.getElementById(`epic-desc-input-${epicIndex}`);
            
            const save = () => {
                epic.title = titleInput.value;
                epic.description = descInput.value;
                titleEl.textContent = epic.title;
                descEl.textContent = epic.description;
            };
            
            titleInput.addEventListener('blur', save);
            descInput.addEventListener('blur', save);
            titleInput.focus();
        }

        function editStory(epicIndex, storyIndex) {
            const story = currentEpics[epicIndex].stories[storyIndex];
            const titleEl = document.getElementById(`story-title-${epicIndex}-${storyIndex}`);
            const descEl = document.getElementById(`story-desc-${epicIndex}-${storyIndex}`);
            
            titleEl.innerHTML = `<input type="text" class="story-title-input" value="${story.title}" id="story-title-input-${epicIndex}-${storyIndex}">`;
            descEl.innerHTML = `<textarea class="story-description-input" id="story-desc-input-${epicIndex}-${storyIndex}">${story.description}</textarea>`;
            
            const titleInput = document.getElementById(`story-title-input-${epicIndex}-${storyIndex}`);
            const descInput = document.getElementById(`story-desc-input-${epicIndex}-${storyIndex}`);
            
            const save = () => {
                story.title = titleInput.value;
                story.description = descInput.value;
                titleEl.textContent = story.title;
                descEl.textContent = story.description;
            };
            
            titleInput.addEventListener('blur', save);
            descInput.addEventListener('blur', save);
            titleInput.focus();
        }

        function toggleStory(epicIndex, storyIndex, accepted) {
            currentEpics[epicIndex].stories[storyIndex].accepted = accepted;
            const storyCard = document.getElementById(`story-${epicIndex}-${storyIndex}`);
            if (accepted) {
                storyCard.classList.remove('rejected');
            } else {
                storyCard.classList.add('rejected');
            }
        }

        function regenerateRequirements() {
            if (confirm('This will generate new requirements and replace the current ones. Continue?')) {
                generateRequirements();
            }
        }

        function aiSuggestExample(section) {
            const examples = {
                problem: "Current dashboard has 15% daily active usage. Users can't see key metrics at a glance - it takes 5+ clicks to find revenue data. This results in 85% of users ignoring the dashboard, costing $200K/year in missed insights and slow decision-making.",
                
                personas: "Sarah Chen, Account Manager at mid-market SaaS companies, manages 50+ B2B accounts and needs to stay on top of client health. Her day is packed with meetings and she's often on-the-go between client calls.\n\nKey Goals: Track client health at a glance, spot issues before clients complain, prepare for calls in under 5 minutes, identify upsell opportunities.\n\nPain Points: Data scattered across 5 different tools (Salesforce, Zendesk, billing, analytics, spreadsheets). Creating client health reports takes 2+ hours. Often blindsided by churn because she didn't see warning signs. Can't access data on mobile when traveling.\n\nBehaviors: Checks dashboard 3-4x per day, often on mobile. Morning routine is coffee + dashboard review (needs <10 min). Works from coffee shops, airports, client offices. Needs quick answers for 'how's my account doing?' questions. Prefers visuals over tables.\n\nResearch Insights: Users don't trust real-time data - they verify in spreadsheets (trust issue to address). Mobile usage spikes Monday mornings and Friday afternoons (travel times). 70% of users only look at 4-5 metrics - the rest is noise. Account managers are measured on retention, so leading indicators are crucial.",
                
                opportunity: "Modern dashboard with real-time metrics can increase engagement from 15% to 60% (4x), reduce 'where's my data' support tickets by 40%, and enable data-driven decisions 3x faster. Estimated annual value: $450K from reduced churn and improved efficiency.",
                
                announcement: "Introducing Your New Dashboard: See What Matters, Instantly\n\nWe've redesigned your dashboard from the ground up. Now you can see your most important metricsâ€”revenue, customers, conversionsâ€”the moment you log in. No more clicking through screens. No more waiting. Just instant insights that help you make better decisions, faster.",
                
                kpi: {
                    name: "Daily Active Users",
                    baseline: "15%",
                    target: "60%",
                    method: "Google Analytics, measure within 3 months"
                },
                
                stakeholders: {
                    dm1: { name: "Sarah Chen", role: "VP Product", status: "aligned" },
                    dm2: { name: "Michael Rodriguez", role: "CTO", status: "pending" },
                    smes: "Design team, Engineering, Data team, Legal, Security, Compliance"
                }
            };
            
            if (section === 'kpi') {
                document.getElementById('kpi1-name').value = examples.kpi.name;
                document.getElementById('kpi1-baseline').value = examples.kpi.baseline;
                document.getElementById('kpi1-target').value = examples.kpi.target;
                document.getElementById('kpi1-method').value = examples.kpi.method;
                autosave();
                return;
            }
            
            if (section === 'stakeholders') {
                document.getElementById('dm1-name').value = examples.stakeholders.dm1.name;
                document.getElementById('dm1-role').value = examples.stakeholders.dm1.role;
                document.getElementById('dm1-status').value = examples.stakeholders.dm1.status;
                document.getElementById('dm2-name').value = examples.stakeholders.dm2.name;
                document.getElementById('dm2-role').value = examples.stakeholders.dm2.role;
                document.getElementById('dm2-status').value = examples.stakeholders.dm2.status;
                document.getElementById('smes-consulted').value = examples.stakeholders.smes;
                autosave();
                return;
            }
            
            if (section === 'personas') {
                const field = document.getElementById('persona-insights');
                const text = examples[section];
                field.value = '';
                let i = 0;
                const typeWriter = setInterval(() => {
                    if (i < text.length) {
                        field.value += text.charAt(i);
                        i++;
                    } else {
                        clearInterval(typeWriter);
                        autosave();
                    }
                }, 5);
                return;
            }
            
            const fieldMap = {
                problem: 'problem-statement',
                opportunity: 'opportunity-statement',
                announcement: 'customer-announcement'
            };
            
            const fieldId = fieldMap[section];
            const field = document.getElementById(fieldId);
            const text = examples[section];
            
            field.value = '';
            let i = 0;
            const typeWriter = setInterval(() => {
                if (i < text.length) {
                    field.value += text.charAt(i);
                    i++;
                } else {
                    clearInterval(typeWriter);
                    autosave();
                }
            }, 5);
        }

        function exportToMarkdown() {
            const briefData = gatherBriefData();
            
            // Build comprehensive markdown
            let markdown = `# Product Brief: ${briefData.title}\n\n`;
            
            // Metadata
            markdown += `**Owner:** ${briefData.owner}\n`;
            markdown += `**Target Quarter:** ${briefData.targetQuarter}\n`;
            markdown += `**Priority:** ${briefData.priority?.toUpperCase()}\n`;
            markdown += `**Est. Value:** ${briefData.value}\n\n`;
            
            markdown += `---\n\n`;
            
            // Executive Summary (AI could generate this, but keeping simple for now)
            markdown += `## Executive Summary\n\n`;
            markdown += `${briefData.problemStatement}\n\n`;
            
            // Problem & Opportunity
            markdown += `## Problem Statement\n\n`;
            markdown += `${briefData.problemStatement}\n\n`;
            if (briefData.problemImpact) {
                markdown += `**Impact:** ${briefData.problemImpact}\n\n`;
            }
            
            markdown += `## Opportunity\n\n`;
            markdown += `${briefData.opportunity}\n\n`;
            
            // Target Users
            markdown += `## Target Users\n\n`;
            markdown += `${briefData.personaInsights}\n\n`;
            markdown += `**What Success Looks Like:** ${briefData.personaSuccess}\n\n`;
            
            // Success Metrics
            markdown += `## Success Metrics\n\n`;
            markdown += `**KPI:** ${briefData.kpi.name}\n`;
            markdown += `- Baseline: ${briefData.kpi.baseline}\n`;
            markdown += `- Target: ${briefData.kpi.target}\n`;
            markdown += `- Measurement: ${briefData.kpi.method}\n`;
            if (briefData.kpi.results && briefData.kpi.results !== 'TBD') {
                markdown += `- **Results:** ${briefData.kpi.results}\n`;
            }
            markdown += `\n`;
            
            // Stakeholders
            markdown += `## Stakeholders\n\n`;
            markdown += `**Decision Makers:**\n`;
            if (briefData.stakeholders.dm1.name) {
                markdown += `- ${briefData.stakeholders.dm1.name} (${briefData.stakeholders.dm1.role}) - Status: ${briefData.stakeholders.dm1.status}\n`;
            }
            if (briefData.stakeholders.dm2.name) {
                markdown += `- ${briefData.stakeholders.dm2.name} (${briefData.stakeholders.dm2.role}) - Status: ${briefData.stakeholders.dm2.status}\n`;
            }
            markdown += `\n`;
            if (briefData.stakeholders.smes) {
                markdown += `**SMEs/Consulted:** ${briefData.stakeholders.smes}\n\n`;
            }
            
            markdown += `---\n\n`;
            
            // Requirements
            markdown += `# Requirements\n\n`;
            
            currentEpics.forEach(epic => {
                markdown += `## ${epic.id}: ${epic.title}\n\n`;
                markdown += `**Description:** ${epic.description}\n\n`;
                markdown += `**User Stories:**\n\n`;
                
                epic.stories.forEach(story => {
                    if (story.accepted !== false) {
                        markdown += `### ${story.id}: ${story.title}\n\n`;
                        markdown += `${story.description}\n\n`;
                        markdown += `- [ ] Ready for implementation\n\n`;
                    }
                });
            });
            
            // Customer-Facing
            markdown += `---\n\n`;
            markdown += `## Customer Announcement\n\n`;
            markdown += `${briefData.announcement}\n\n`;
            markdown += `**One-line benefit:** ${briefData.benefit}\n\n`;
            
            // Download
            const blob = new Blob([markdown], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${briefData.title.replace(/\s+/g, '-').toLowerCase()}-brief.md`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('Markdown exported! You can now upload this file to Claude to generate executive summaries, status reports, or other artifacts.');
        }
    </script>
</body>
</html>
